# [MUSINSA] Java(Kotlin) Backend Engineer - 과제

### 구현 범위
- 구현 4가지와, 유닛, 통합 테스트
- Service, Adapter 클래스 테스트 커버리지 100%
- DB 인덱스
- 기본적인 에러처리

### 기본적인 과제 구현 방향
간단한 CRUD 과제이기 때문에 Redis나 Kafka와 같은 별도의 시스템을 사용하지 않고, 단일 서비스 내에서 구현했습니다. 
Layered Architecture를 기반으로, 도메인 레이어와 영속성 레이어를 별도로 분리해서 작성했고, Hexagonal Architecture의 일부(도메인 비즈니스 모델의 집중하도록) 구조를 채용했습니다.  따라서, 도메인 레이어와 영속성 레이어의 강결합을 피해 JPA Dirty Checking 인한 JPA의 등작을 의도적으로 덜어내어 비즈니스 로직에 JPA가 개입할 여지를 줄였습니다.
```
com.musinsa.category
├── domain (도메인 레이어)
├── persistence (영속성 레이어)
├── adapter (영속성 <-> 도메인 레이어를 연결하는 패키지)
├── mapper (영속성 <-> 도메인 레이어 간의 데이터 변환을 담당하는 패키지)
├── presentation (도메인 레이어에서 만들어진 데이터를 외부에 가공하기 위한 패키지)
└── support (기타)
```

---
## 추가적으로 고민 할 수 있는 것들
문제의 요구사항이 간단하기 때문에, 과도한 설계는 필요하지 않았지만, 몇 가지 고민했던 포인트들이 있습니다.

### 1. 데이터 사이즈가 커질 경우 (리얼 월드)
- **[구현 1]**, **[구현 3]** 의 경우 DB의 복합 인덱스로 스캔 범위를 좁혀 어느정도 성능 향상을 얻을 수 있습니다.
- 브랜드와 카테고리, 제품을 한 번에 모두 조회해서 계산하는 것은 성능상 문제가 될 수 있어서 집계 로직 아키텍처에 대한 고민이 필요합니다. 
- 따라서 **[구현 2]** 의 경우 브랜드의 상품이 많을 경우 모든 브랜드의 계산의 합을 비교해야 하기 때문에, 제품의 추가/삭제/변경이 될 경우 Kafka를 통해서 비동기로 해당 브랜드의 총 합을 계산해 ElasticSearch, Redis, DB 등 별도의 저장소에 갱신해 놓은 다음, 서빙 할 때 정렬 순으로 응답하는 방식을 고려할 수 있습니다. 

### 2. 상품 추가에 대한 문제
과제에는 브랜드 당 카테고리에는 1개의 상품이 존재한다고 되어 있습니다. 다만, 이에 따른 별도의 제약 조건이 나와있지 않았기 때문에 **[과제 4]** 를 구현하면서 이 룰을 지키면서 브랜드를 추가하는 것은 아래와 같은 제약조건에 대한 고민이 좀 필요합니다.
- 특정 브랜드를 한 번에 모든 카테고리를 최소 1개 이상 등록하게 하거나

또한, 비즈니스의 확장으로 새로운 카테고리도 당연히 추가할 수 있기 때문에 구현은 했지만, 아래와 같은 제약조건이 필요할 것 같습니다.
- 카테고리를 추가할 때 모든 브랜드의 상품을 최소 1개 이상 등록하게 하거나

이 두가지의 제약조건이 없다면, **[구현 2]**, **[구현 3]** 에서 아래와 같은 상황이 발생합니다.
- 새 카테고리만 추가할 경우, 브랜드의 상품이 없기 때문에 **[구현 3]** 에서 해당 카테고리를 조회하면 빈 리스트가 나올 수 있음
- 새 브랜드만 추가할 경우, 브랜드의 상품이 없기 때문에 **[구현 2]** 에서 해당 브랜드를 조회하면 0원짜리 합이 나올 수 있음
- 새 카테고리에 상품을 1개만 추가할 경우, 특정 브랜드의 상품이 없기 때문에 **[구현 2]** 에서 단일 카테고리 상품의 합이 나올 수 있음

실 서비스 구현시 콜드 케이스에 대한 추가적인 제약조건이 필요할 것 같고, 아래 제약조건을 추가했습니다.
- **[구현 2]** 브랜드의 상품의 합이 0인 경우 제외하고 응답함

---
## 실행 환경
- Java 17
- Gradle 8.12.1

## 실행
```shell
 ./buildAndRun.sh
```

## 테스트
1. Intellij IDEA - HTTP 테스트 (test.http)
2. Unit/Integration Test
```shell
./gradlew test
```